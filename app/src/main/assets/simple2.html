<!DOCTYPE html>

<meta charset="UTF-8">
<title>WebCodecs API Streamr Demo</title>
<style>
    button {
        background-color: #555555;
        border: 2px;
        border-radius: 2px;
        color: white;
        padding: 15px 32px;
        width: 1280px;
        text-align: center;
        display: block;
        font-size: 16px;
    }
</style>

<body>
    <div>Hello World!</div>
    <div id="textbox"></div>
</body>
<script type="text/javascript" src="streamr-client.web.min.js"></script>
<script>
    function addText(content) {
        var textbox = document.getElementById("textbox");
        var newText = document.createElement("p");
        newText.textContent = content;
        textbox.insertBefore(newText, textbox.firstChild)
        //textbox.appendChild(newText);
        textbox.scrollTop = textbox.scrollHeight;
    }

    const client = new StreamrClient({
        auth: {
            privateKey: "13e1f58ff9896f48e9f0ff4a8d6b93d889fedca00c97a18d1f35b06e18b99b3a"
        },
        logLevel: 'trace'
    })

    async function sendToStreamr() {
        const message = { id: Math.floor(Math.random() * 1000) }
        const response = await client.publish({ id: "0x937934175ca694b5f66f4c96b11f25a326b4cc5d/demostream", partition: 4 }, message)
    }

    setInterval(sendToStreamr, 1000)

    const { address, privateKey } = StreamrClient.generateEthereumAccount();

    /*const clientReceiver = new StreamrClient({
        auth: {
            privateKey: privateKey
        },
        logLevel: 'trace'
    })*/

    client.subscribe({ id: "0x937934175ca694b5f66f4c96b11f25a326b4cc5d/demostream", partition: 3 },
        (content, metadata) => {
            //check if we received video or audio chunk
            //pass video chunks to video attr
            //audio chunks to audio attr
            addText(JSON.stringify(content))
        });




    //document.body.onload = main;
</script>